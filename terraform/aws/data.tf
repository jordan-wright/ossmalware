locals {
  sqs_name      = "${var.service_name}-sqs-${random_string.random.result}"
  s3_name       = "${var.service_name}-results-${random_string.random.result}"
  template_name = "${var.service_name}-template"
  asg_name      = "${var.service_name}-asg"
  ec2_name      = "${var.service_name}-worker"
  role_name     = "${var.service_name}-role"
  profile_name  = "${var.service_name}-profile"
  policy_name   = "${var.service_name}-policy"
  sg_name       = "${var.service_name}-sg"
  access_enable = var.ssh_key_name != "" ? true : false
}

resource "random_string" "random" {
  length  = 10
  upper   = false
  special = false
}

data "aws_ami" "linux" {
  most_recent = true

  filter {
    name   = "name"
    values = [var.boot_disk_image_prefix]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }

  filter {
    name   = "owner-alias"
    values = ["amazon"]
  }

  filter {
    name   = "architecture"
    values = ["x86_64"]
  }
}